# Task Storage Guide

This guide outlines the mechanism for storing and tracking tasks created via the `<new_task>` tool within this project simulation.

## Storage Location

All tasks generated by modes **MUST** be stored as individual files within the `.ruru/tasks/` directory. The delegating (reporter) mode is responsible for creating this file before initiating the `<new_task>` tool use.

## File Naming Convention

Each task file **MUST** follow the naming convention:
`TASK-{AssigneeSlug}-{TaskID}.md`

*   `{AssigneeSlug}`: The slug of the mode the task is assigned to (determined by the delegating mode from the task content).
*   `{TaskID}`: A unique `YYYYMMDDHHMMSS` timestamp generated by the delegating mode at the time of task creation. This same timestamp **MUST** be used for the `id` field within the task file's frontmatter.

**Example:** `TASK-lead-architect-20250508120000.md`

This convention ensures task persistence and provides a unique identifier tied to the assignee and creation time.

## File Content

The content of each task file **MUST** be the complete message payload prepared by the delegating mode, based on the standard task template (e.g., `\.ruru/templates/template-v1.md`). This includes:
1.  The frontmatter block (`+++ ... +++`) with all fields populated.
2.  The `id` field within the frontmatter **MUST** be replaced by the delegating mode with the same `YYYYMMDDHHMMSS` timestamp string (`{TaskID}`) used in the filename.
3.  The initial `status` field should be set to `TASK_INITIATED` (or equivalent).
4.  The markdown body (`# {Task Title}` etc.).

```markdown
+++
# Example showing ID replaced with timestamp by delegating mode
id = "20250508120000"
status = "TASK_INITIATED" # Initial status set by delegator
assignee = "team-lead-backend"
reporter_mode = "architect"
tags = ["api", "design"]
priority = "High"
estimated_effort = "Medium"
due_date = "2025-05-15"
epic_link = "EPIC-007"
required_context = "See ADR-008 for data model decisions."
expected_outcome = "API contract for /users endpoint defined and documented."
template_version = "1.5" # Example version
+++

# Feat: Define User API Contract

Design and document the API contract (request/response schemas, endpoints) for the primary /users resource based on the requirements in STORY-99 and ADR-008.
```

## Task Updates

Updates to a task's status or content (e.g., changing status from `TASK_INITIATED` to `PROCESSING_STARTED` or `TASK_COMPLETED`, adding comments) **SHOULD** be made by the assigned mode by modifying the corresponding task file directly. Modes with `edit` permissions can use tools like `apply_diff` or `write_to_file` (with the full content) to update these files. Task files may therefore reflect intermediate statuses during their lifecycle.

## Rationale

Storing tasks as individual files provides:
*   **Persistence:** Tasks are not lost between sessions.
*   **Traceability:** The delegation process (file creation by delegator, subsequent updates by assignee) is clearer.
*   **Trackability:** Allows external tools or scripts (or modes with file system access) to potentially parse and report on task status.
*   **Audit Trail:** Changes to tasks can be tracked if the `.ruru/tasks/` directory is under version control.

**Note:** This process relies on the delegating mode successfully creating the task file before using `<new_task>` and the assignee mode successfully reading the referenced file. Error handling for these steps is crucial and outlined in the "Task Persistence and Delegation Guideline" within `\.roo/rules/global/03-mode-behavior-rules.md`.