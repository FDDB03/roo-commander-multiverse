# Task Storage Guide

This guide outlines the intended mechanism for storing and tracking tasks created via the `<new_task>` tool within this project simulation.

## Storage Location

All tasks generated by modes **SHOULD** ideally be stored as individual files within the `.ruru/tasks/` directory.

## File Naming Convention

Each task file **SHOULD** ideally follow the naming convention:
`TASK-{ID}.md`

*   `{ID}`: This corresponds to the unique `id = "{AUTO_INCREMENT}"` field generated within the task's frontmatter when using the `<new_task>` tool. The system managing the modes is expected to handle the auto-incrementing ID generation and potentially the saving of the task file using this convention.

**Example:** `TASK-042.md`

### Manual Saving Workaround Convention

**Note:** Due to current system limitations where the auto-generated `{ID}` is not returned and automatic saving may not be implemented, a manual saving workaround is required (see the "Task Persistence Guideline (Assignee Saves - Workaround)" in `.roo/rules/global/03-mode-behavior-rules.md`). When this manual saving is performed by the assignee mode, the following timestamp-based convention **MUST** be used:

`TASK-{Assignee}-{YYYYMMDDHHMMSS}.md`

*   `{Assignee}`: The slug of the mode the task is assigned to (extracted from the task message).
*   `{YYYYMMDDHHMMSS}`: A timestamp generated by the assignee mode at the time of the save operation.

**Example:** `TASK-lead-architect-20250505233000.md`

This ensures task persistence even when the ideal ID-based naming is not achievable.

## File Content

The content of each task file **MUST** be the complete message payload provided in the `<message>` tag of the `<new_task>` command, after any required placeholder replacements (like `{TIMESTAMP_ID}`). This includes the frontmatter block (`+++ ... +++`) and the markdown body (`# {Task Title}` etc.).

**Important Note on `id` field during Manual Saving:** When the assignee mode uses the manual saving workaround, the `id` field within the frontmatter (originally a placeholder like `"{AUTO_INCREMENT}"` or `"{TIMESTAMP_ID}"` in the template) **MUST** be replaced by the assignee with the same `YYYYMMDDHHMMSS` timestamp string used in the filename. This provides a unique identifier within the file content itself.

```markdown
+++
# Example showing ID replaced with timestamp during manual save
id = "20250505233000"
status = "pending"
assignee = "team-lead-backend"
reporter_mode = "architect"
tags = ["api", "design"]
priority = "High"
estimated_effort = "Medium"
due_date = "2025-05-15"
epic_link = "EPIC-007"
required_context = "See ADR-008 for data model decisions."
expected_outcome = "API contract for /users endpoint defined and documented."
template_version = "1.4" # Assuming template was updated
+++

# Feat: Define User API Contract

Design and document the API contract (request/response schemas, endpoints) for the primary /users resource based on the requirements in STORY-99 and ADR-008.
```

## Task Updates

Updates to a task's status or content (e.g., adding comments, changing status from `pending` to `in-progress`) **SHOULD** be made by modifying the corresponding task file directly. Modes with `edit` permissions can use tools like `apply_diff` or `write_to_file` (with the full content) to update these files.

## Rationale

Storing tasks as individual files provides:
*   **Persistence:** Tasks are not lost between sessions.
*   **Trackability:** Allows external tools or scripts (or modes with file system access) to potentially parse and report on task status.
*   **Audit Trail:** Changes to tasks can be tracked if the `.ruru/tasks/` directory is under version control.

**Note:** The actual implementation of automatically saving tasks created via `<new_task>` to the ideal `TASK-{ID}.md` structure may depend on the capabilities of the underlying system running the modes. The manual saving workaround, where the *assignee* mode saves the task using the `TASK-{Assignee}-{YYYYMMDDHHMMSS}.md` filename and replaces the internal `id` field with the timestamp, is the required procedure until automatic saving is implemented.